<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Property Calculator</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/font-awesome-4.6.3/css/font-awesome.min.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
<style type="text/css">
	.prices{
		font-size: 20px;
	    font-weight: bold;
	    color: #c78d04;
	}
	.user_results{
		font-weight: bold;
	    color: #c78d04;
	}
	.results{
		visibility:hidden;
	}

</style>
    <!-- Custom JS -->
	
<!-- <script src="./papaparse.min.js"></script> --> 
<!-- <script src="js/cvs_parser.js"></script> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="js/results_retriever.js"></script>


<script src="PapaParse-4.1.2/papaparse.min.js"></script>
<script>

$(document).ready(function(){
    $("#csv-file").change(handleFileSelect);
});

  var data;
  var price = [];
  var bathrooms = [];
  var bedrooms = [];
  var square_ft = [];

  // The median values of each category
  var price_standard;
  var bathrooms_standard;
  var bedrooms_standard;
  var square_ft_standard;

  // handles the uploaded CSV file
  // TODO: Find a way to keep the file on the server instead 
  // 	   without having to upload it!
  function handleFileSelect(evt) {
    var file = evt.target.files[0];
    Papa.parse(file, {
      header: true,
      dynamicTyping: true,
      complete: function(data) {
                
        // console.log(data); 
        var data_size = data.data.length;
        var i;
        for(i = 0; i < data_size; i++){
        	price[i] 	 = data.data[i].price;
        	bathrooms[i] = data.data[i].bathrooms;
        	bedrooms[i]  = data.data[i].bedrooms;
        	square_ft[i] = data.data[i]['square-foot'];
        }
        setStandard();
        displayPropertyPrice();
      }
    });
  }

  function gofunction(){

		var a = document.getElementById("bookForm").elements.namedItem("name").value;
		document.getElementById("property").innerHTML = a;

		var b = document.getElementById("bookForm").elements.namedItem("bedrooms").value;
		document.getElementById("bedrooms").innerHTML = b;

		var c = document.getElementById("bookForm").elements.namedItem("bathrooms").value;
		document.getElementById("bathrooms").innerHTML = c;

		var d = document.getElementById("bookForm").elements.namedItem("squarefeet").value;
	    document.getElementById("squarefeet").innerHTML = d;

		console.log("PRICE: " 	    + price_standard);
		console.log("BEDROOMS: "    + bedrooms_standard);
		console.log("BATHROOMS: "   + bathroom_standard);
		console.log("SQUARE-FOOT: " + square_ft_standard);	   

		var userPropNoPrice = propertyBedBathPerSqCalc(parseInt(b),parseInt(c),parseInt(d));

		console.log(userPropNoPrice);

		var userPropWithPrice = propertyPriceCalculation(price_standard,
													  bedrooms_standard,
													  bathroom_standard, 
													  square_ft_standard,
													  userPropNoPrice);

		document.getElementById("price").innerHTML = '$' + Math.round(userPropWithPrice) + " ";

		$(".results").css("visibility","visible");

  }

	// Determines the price of a home given user inputs
	// http://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_form_elements_index


	// SORTS THE ARRAY AND GETS THE MEDIAN
	function getStandard(){

	  	 price.sort(function(a, b){return a-b});
	  	 bathrooms.sort(function(a, b){return a-b});
	  	 bedrooms.sort(function(a, b){return a-b});
	  	 square_ft.sort(function(a, b){return a-b});

	  	 // set the standards!
	  	 price_standard     = median(price);
	  	 bedrooms_standard  = median(bedrooms);
	  	 bathroom_standard  = median(bathrooms);
	  	 square_ft_standard = median(square_ft);

	  	 return [price_standard, bedrooms_standard,bathroom_standard,square_ft_standard];

	}

	// TAKES THE DATA AND SETS A STANDARD FOR THE ALGORITHM TO USE
	function setStandard(){
		var data = getStandard();
		price_standard = data[0];
		bedrooms_standard = data[1];
		bathroom_standard = data[2];
		square_ft_standard = data[3];
	}

  // DISPLAY GIVEN ARGUMENT VALUES
  function displayPropertyPrice(){

  	 // debugging - to DELETE
 	 // console.log("PRICE: " 	     + price_standard);
  	 // console.log("BEDROOMS: "    + bedrooms_standard);
  	 // console.log("BATHROOMS: "   + bathroom_standard);
  	 // console.log("SQUARE-FOOT: " + square_ft_standard);

  	 var propertyValNoPrice1 = propertyBedBathPerSqCalc(2,2,1250);
  	 var property_price1 = propertyPriceCalculation(price_standard, bedrooms_standard, bathroom_standard, square_ft_standard,propertyValNoPrice1);
  	 $( "#price1" ).append("$" + Math.round(property_price1) );


  	 var propertyValNoPrice2 = propertyBedBathPerSqCalc(1,1,750);
  	 var property_price2 = propertyPriceCalculation(price_standard, bedrooms_standard, bathroom_standard, square_ft_standard,propertyValNoPrice2);
  	 $( "#price2" ).append("$" + Math.round(property_price2) );

  	 
 	 var propertyValNoPrice3 = propertyBedBathPerSqCalc(3,1,1500);
  	 var property_price3 = propertyPriceCalculation(price_standard, bedrooms_standard, bathroom_standard, square_ft_standard,propertyValNoPrice3);
  	 $( "#price3" ).append("$" + Math.round(property_price3) );

 	 var propertyValNoPrice4 = propertyBedBathPerSqCalc(4,2,2250);
  	 var property_price4 = propertyPriceCalculation(price_standard, bedrooms_standard, bathroom_standard, square_ft_standard,propertyValNoPrice4);
  	 $( "#price4" ).append("$" + Math.round(property_price4) );



  };

  // DETERMINES SET RATIO TO USE FOR ALGORITHM
  function propertyBedBathPerSqCalc(bed,bath,sq)
  {

  	return  sq/[bed + bath];
  };

  // ALGORITHM TO COMPUTE PRICE GIVEN BED/BATH/SQ-FT
  function propertyPriceCalculation(price,bed,bath,sq,otherProp)
  {
  	// add bathroom and bedrooms
  	// divide the square-feet by # of ba/br total
  	var bed_bath_sq_total = sq/[bed + bath];

  	// calculate ratio b*x = a*c
  	var determined_price = [price*otherProp]/bed_bath_sq_total;

  	return determined_price;
  };

/* Didn't want to reinvent the wheel!
   CODE Snippet taken from: https://gist.github.com/caseyjustus/1166258 
*/
function median(values) {

    values.sort( function(a,b) {return a - b;} );
    var half = Math.floor(values.length/2);
    if(values.length % 2)
        return values[half];
    else
        return (values[half-1] + values[half]) / 2.0;
};

</script>

  </head>
  <body>
<div class="container">
    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Property Calculator</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
             <li><a href="#" 
   data-toggle="modal" 
   data-target="#about">About</a>
</li>
              </ul>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="../navbar/">Github</a></li>
          
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>




    <div class="row" style="margin-top:100px;">
	
	<div class="col-lg-12 text-center">

	<i>PRICING</i> determined by property calculation with 1000 properties <br>
	<br />
		<p><strong>Casa Maria</strong> - 2bd, 2ba, 1250 square feet: PRICE --&gt; 		 <span class="prices" id="price1"></span></p>
		<p><strong>Westwood Towers</strong> - Studio, 1ba, 750 square feet: PRICE --&gt; <span class="prices" id="price2"></span></p>
		<p><strong>Bella Fortuna</strong> - 3bd, 1ba, 1500 square feet: PRICE --&gt; 	 <span class="prices" id="price3"></span></p>
		<p><strong>Palace Apartments</strong> - 4bd, 2ba, 2250 square feet: PRICE --&gt; <span class="prices" id="price4"></span></p>

		<br />
		<br />

		<div>
    		<input type="file" id="csv-file" name="files"/>
    	</div>
	</div>		
	
	


<form id="bookForm" method="post" class="form-horizontal">
    <div class="form-group">

        <div class="col-xs-3 col-xs-offset-1">
            <input type="text" class="form-control" name="name" placeholder="Property Name (optional)" />
        </div>
        <div class="col-xs-2">
            <input type="number" class="form-control" name="bedrooms" placeholder="# of bedrooms" />
        </div>
        <div class="col-xs-2">
            <input type="number" class="form-control" name="bathrooms" placeholder="# of bathrooms" />
        </div>
        <div class="col-xs-2">
            <input type="number" class="form-control" name="squarefeet" placeholder="# Square ft" />
        </div>

        <div class="col-xs-2">
            <button type="button" class="btn btn-default addButton"><i class="fa fa-plus"></i></button>
        </div>

    </div>

    <!-- The template for adding new field -->
<!--     <div class="form-group hide" id="bookTemplate">
        <div class="col-xs-3 col-xs-offset-1">
            <input type="text" class="form-control" name="name" id="name" placeholder="Property Name (optional)" />
        </div>
        <div class="col-xs-2">
            <input type="text" class="form-control" name="bedrooms" placeholder="# of bedrooms" />
        </div>
        <div class="col-xs-2">
            <input type="text" class="form-control" name="bathrooms" placeholder="# of bathrooms" />
        </div>
        <div class="col-xs-2">
            <input type="text" class="form-control" name="squarefeet" placeholder="# Sqaure ft" />
        </div>

        <div class="col-xs-1">
            <button type="button" class="btn btn-default removeButton"><i class="fa fa-minus"></i></button>
        </div>
    </div> -->

    <div class="form-group">
        <div class="col-xs-5 col-xs-offset-1">
<!--           <button type="button" class="btn btn-default" id="addNewReq" data-target="#results" data-toggle="modal" style="background-color: #71f968;">Submit</button> -->

          <button type="button" class="btn btn-default" id="addNewReq" onclick="gofunction()" style="background-color: #71f968;">Submit</button> 

  				</div>
    		</div>
		</form>
	</div>
</div>


	<div class="results col-xs-12 text-center">
		<p style="font-size:xx-large"><span class="user_results" id="property"></span> with <span class="user_results" id="bedrooms"></span> bedroom(s) & <span class="user_results" id="bathrooms"></span> bathroom(s) at <span class="user_results" id="squarefeet"></span>sq-ft is valued at: <br><span class="user_results" id="price"></span>(USD)</p>
	</div>
					   
					  


<!-- RESULTS Modal -->
 <div class="modal fade" id="results" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&amp;times;</button>
            <h4 class="modal-title" id="myModalLabel">Property Pricing</h4>
            </div>
            <div class="modal-body">
                <h3>Property Name</h3>
                <span>Priced Recommenedation:</span><span><strong>$1,000</strong></span>
					<!-- DISPLAY OF RESULTS -->
					    <div id="demo1"></div>
					    <div id="demo2"></div>
					    <div id="demo3"></div>
					    <div id="demo4"></div>
					    <div id="demo5"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
        </div>
    </div>
  </div>
</div>


<!-- ABOUT Modal -->
 <div class="modal fade" id="about" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&amp;times;</button>
            <h4 class="modal-title" id="myModalLabel">Property Pricing</h4>
            </div>
            <div class="modal-body">
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
        </div>
    </div>
  </div>
</div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script>
$(document).ready(function() {
    var titleValidators = {
            row: '.col-xs-4',   // The title is placed inside a <div class="col-xs-4"> element
            validators: {
                notEmpty: {
                    message: 'The title is required'
                }
            }
        },
        bedroomValidators = {
            row: '.col-xs-3',
            validators: {
                notEmpty: {
                    message: 'The ISBN is required'
                },
                isbn: {
                    message: 'The ISBN is not valid'
                }
            }
        },
           bathroomValidators = {
            row: '.col-xs-3',
            validators: {
                notEmpty: {
                    message: 'The ISBN is required'
                },
                isbn: {
                    message: 'The ISBN is not valid'
                }
            }
        },
        priceValidators = {
            row: '.col-xs-3',
            validators: {
                notEmpty: {
                    message: 'The price is required'
                },
                numeric: {
                    message: 'The price must be a numeric number'
                }
            }
        },
        bookIndex = 0;

    $('#bookForm')
        // .formValidation({
        //     framework: 'bootstrap',
        //     icon: {
        //         valid: 'glyphicon glyphicon-ok',
        //         invalid: 'glyphicon glyphicon-remove',
        //         validating: 'glyphicon glyphicon-refresh'
        //     },
        //     fields: {
        //         'book[0].title': titleValidators,
        //         'book[0].isbn': isbnValidators,
        //         'book[0].price': priceValidators
        //     }
        // })

        // Add button click handler
        .on('click', '.addButton', function() {
            bookIndex++;
            var $template = $('#bookTemplate'),
                $clone    = $template
                                .clone()
                                .removeClass('hide')
                                .removeAttr('id')
                                .attr('data-book-index', bookIndex)
                                .insertBefore($template);

            // Update the name attributes
            $clone
                .find('[name="title"]').attr('name', 'book[' + bookIndex + '].title').end()
                .find('[name="isbn"]').attr('name', 'book[' + bookIndex + '].isbn').end()
                .find('[name="price"]').attr('name', 'book[' + bookIndex + '].price').end();

            // Add new fields
            // Note that we also pass the validator rules for new field as the third parameter
            $('#bookForm')
                // .formValidation('addField', 'book[' + bookIndex + '].title', titleValidators)
                // .formValidation('addField', 'book[' + bookIndex + '].isbn', isbnValidators)
                // .formValidation('addField', 'book[' + bookIndex + '].price', priceValidators);
        })

        // Remove button click handler
        .on('click', '.removeButton', function() {
            var $row  = $(this).parents('.form-group'),
                index = $row.attr('data-book-index');

            // Remove fields
            $('#bookForm')
                // .formValidation('removeField', $row.find('[name="book[' + index + '].title"]'))
                // .formValidation('removeField', $row.find('[name="book[' + index + '].isbn"]'))
                // .formValidation('removeField', $row.find('[name="book[' + index + '].price"]'));

            // Remove element containing the fields
            $row.remove();
        });
});
</script>
  </body>
</html>